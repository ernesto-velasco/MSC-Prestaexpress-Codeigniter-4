"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[557],{3905:function(e,n,r){r.d(n,{Zo:function(){return c},kt:function(){return m}});var a=r(7294);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function o(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,a,t=function(e,n){if(null==e)return{};var r,a,t={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var l=a.createContext({}),p=function(e){var n=a.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var r=e.components,t=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),m=t,g=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return r?a.createElement(g,i(i({ref:n},c),{},{components:r})):a.createElement(g,i({ref:n},c))}));function m(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var o=r.length,i=new Array(o);i[0]=u;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:t,i[1]=s;for(var p=2;p<o;p++)i[p]=r[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}u.displayName="MDXCreateElement"},5618:function(e,n,r){r.r(n),r.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return d}});var a=r(7462),t=r(3366),o=(r(7294),r(3905)),i=["components"],s={sidebar_position:1},l="Crear Login en CodeIgniter 4",p={unversionedId:"Login/crear-login",id:"Login/crear-login",title:"Crear Login en CodeIgniter 4",description:"Crear formulario de Login",source:"@site/docs/Login/crear-login.md",sourceDirName:"Login",slug:"/Login/crear-login",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/Login/crear-login",editUrl:"https://github.com/vegonz/MSC-Prestaexpress-Codeigniter-4/tree/master/docs/docs/Login/crear-login.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"1 Introducci\xf3n",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/intro"},next:{title:"Cerrar sesi\xf3n",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/Login/cerrar-sesion"}},c={},d=[{value:"Crear formulario de Login",id:"crear-formulario-de-login",level:2},{value:"Crear Modelo Empleado",id:"crear-modelo-empleado",level:2},{value:"Controlador Auth",id:"controlador-auth",level:2},{value:"Crear rutas",id:"crear-rutas",level:2}],u={toc:d};function m(e){var n=e.components,r=(0,t.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"crear-login-en-codeigniter-4"},"Crear Login en CodeIgniter 4"),(0,o.kt)("h2",{id:"crear-formulario-de-login"},"Crear formulario de Login"),(0,o.kt)("p",null,"Cambiar la p\xe1gina por defecto de CodeIgniter:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Crear archivo ",(0,o.kt)("inlineCode",{parentName:"li"},"app/views/auth/login.php"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="app/Views/auth/login.php"',title:'"app/Views/auth/login.php"'},'<!DOCTYPE html>\n<html lang="es-MX">\n\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Login | Prestaexpress</title>\n    \x3c!-- bootstrap --\x3e\n    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">\n</head>\n\n<body>\n    <header></header>\n    <main>\n        <div class="container pb-5">\n            \x3c!-- login --\x3e\n            <div class="container">\n                <div class="row justify-content-center align-items-center" style="height:100vh">\n                    <div class="col-md-4">\n                        <?php if (session(\'error\')) : ?>\n                            <div class="alert alert-danger" role="alert">\n                                <?php echo session(\'error\'); ?>\n                            </div>\n                        <?php endif; ?>\n                        <div class="card">\n                            <div class="card-body">\n                                <h5>Iniciar sesi\xf3n</h5>\n                                <hr>\n                                <form action="<?php echo base_url(\'/auth/login\'); ?>" autocomplete="off" method="post">\n                                    <div class="form-group">\n                                        <input type="text" class="form-control bg-light text-dark" name="usuario" placeholder="Usuario">\n                                    </div>\n                                    <div class="form-group">\n                                        <input type="password" class="form-control bg-light text-dark" name="contrasena" placeholder="Contrase\xf1a">\n                                    </div>\n                                    <button type="submit" class="btn btn-primary">Entrar</button>\n                                </form>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \x3c!-- /login --\x3e\n        </div>\n    </main>\n    \x3c!-- bootstrap --\x3e\n    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"><\/script>\n    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"><\/script>\n</body>\n\n</html>\n')),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"La ruta ",(0,o.kt)("inlineCode",{parentName:"p"},"base_url('/auth/login')")," indica el controlador donde sera procesada la informaci\xf3n del formulario y que sera creada en los siguientes pasos")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Actualizar controlador ",(0,o.kt)("inlineCode",{parentName:"li"},"app/Controllers/Home.php")," quitando la linea en rojo y agregando la linea verde del c\xf3digo de abajo")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-diff",metastring:'title="app/Controllers/Home.php"',title:'"app/Controllers/Home.php"'},"<?php\n\nnamespace App\\Controllers;\n\nclass Home extends BaseController\n{\n    public function index()\n    {\n-      return view('welcome_page');\n+      return view('auth/login');\n    }\n}\n")),(0,o.kt)("h2",{id:"crear-modelo-empleado"},"Crear Modelo Empleado"),(0,o.kt)("p",null,"Creamos y configuramos el modelo empleado para poder acceder a la informaci\xf3n de la base de datos"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Crear el archivo ",(0,o.kt)("inlineCode",{parentName:"li"},"app/Models/EmpleadoModel.php"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Models/EmpleadoModel.php"',title:'"app/Models/EmpleadoModel.php"'},"<?php\n\nnamespace App\\Models;\n\nuse CodeIgniter\\Model;\n\nclass EmpleadoModel extends Model\n{\n    // * configuraci\xf3n del modelo\n    // la tabla principal sobre la que trabaja el modelo\n    protected $table = 'empleado';\n\n    // columna que identifica de manera \xfanica a un registro en la tabla (usado p.e. para buscar registros)\n    protected $primaryKey = 'id_empleado';\n\n    // indica si la tabla usa la opci\xf3n auto-incrementable, si es false entonces se debe especificar el valor manualmente\n    protected $useAutoIncrement = true;\n\n    // tipo de respeusta por defecto (object, array)\n    protected $returnType = 'object';\n\n    // eliminado l\xf3gico: si es true, m\xe9todo delete() no eliminara permanentemente el registro de la bd\n    // en su lugar establecer\xe1 la fecha actual en la columna $deletedField, al buscar un registro unicamente\n    // mostrara los registros con $deletedField nulo, salvo que especifiquemos lo contrario\n    protected $useSoftDeletes = true;\n\n    // indica si la fecha actual sera a\xf1adida autom\xe1ticamente en los 'inserts' y 'updates',\n    // si es true, requiere que la tabla contenga columnas 'created_at', 'updated_at'\n    protected $useTimestamps = true;\n\n    // especifica el campo  que guarda la fecha en que se inserta un registro a la bd\n    protected $createdField = 'fecha_ingreso';\n\n    protected $updatedField = false;\n\n    // especifica el campo  que guarda la fecha en que se actualiza un registro a la bd\n    protected $deletedField = 'fecha_egreso';\n\n    protected $allowedFields    =\n    [\n        'usuario',\n        'emp_nombre',\n        'estado',\n        'contrasena'\n    ]; // Obligatorio, son los campos que se permite modificar desde el controlador\n}\n\n")),(0,o.kt)("h2",{id:"controlador-auth"},"Controlador Auth"),(0,o.kt)("p",null,"Creamos el controlador ",(0,o.kt)("inlineCode",{parentName:"p"},"app/Controllers/AuthController.php")," que contendr\xe1 la l\xf3gica autenticar usuarios"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Controllers/AuthController.php"',title:'"app/Controllers/AuthController.php"'},"<?php\n\nnamespace App\\Controllers;\n\nuse App\\Models\\EmpleadoModel;\n\nclass AuthController extends BaseController\n{\n    // funci\xf3n para iniciar sesi\xf3n\n    public function login()\n    {\n        // Recibir datos del formulario\n        $usuario = $this->request->getPost('usuario');\n        $contrasena = $this->request->getPost('contrasena');\n\n        // Crear una instancia de la clase modelo Empleado\n        $empleadoModel = new EmpleadoModel();\n\n        // Buscar empleado por usuario en la bd\n        $empleado = $empleadoModel->where('usuario', $usuario)->first();\n\n        // Crear una instancia de session\n        $session = session();\n\n        // Retornar mensaje de error si el usuario no existe\n        if (is_null($empleado)) :\n            $session->setFlashdata('error', 'No existe un usuario con ese nombre, intenta de nuevo.');\n            return redirect()->to(base_url('/'));\n        endif;\n\n        // Retornar mensaje de error si la contrase\xf1a es incorrecta\n        if ($empleado->contrasena != $contrasena) :\n            $session->setFlashdata('error', 'La contrase\xf1a es incorrecta, intenta de nuevo.');\n            return redirect()->to(base_url('/'));\n        endif;\n\n        // Si el usuario y la contrase\xf1a son correcos\n        // se crea una sesi\xf3n con la info del usuario\n        $session->empleado = $empleado;\n\n        // redirigimos a la vista de administraci\xf3n\n        return redirect()->to(base_url('/admin'));\n    }\n\n    // Aqu\xed va a ir la funci\xf3n para cerra sesi\xf3n\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"return redirect()->to(base_url('/admin'));"))," es la vista de administraci\xf3n que crearemos despu\xe9s")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Las ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"sesiones"))," permiten seguir la actividad del usuario mientras navega por el sitio, un ejemplo son las cockies usadas por los sitios web para recopilar informaci\xf3n de los usuarios.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Los ",(0,o.kt)("strong",{parentName:"p"},"flashdata"),", que es informaci\xf3n de sesi\xf3n que estar\xe1 disponible ",(0,o.kt)("em",{parentName:"p"},"unicamente en la siguiente vista y desaparecer\xe1 despu\xe9s de recargar o cambiar de p\xe1gina"),", sirve para enviar informaci\xf3n temporal (Como informaci\xf3n de errores) al usuario.")),(0,o.kt)("h2",{id:"crear-rutas"},"Crear rutas"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Modificamos el archivo ",(0,o.kt)("inlineCode",{parentName:"li"},"app/Config/Routes.php")," para crear la ruta para el controlador AuthController, la definimos del tipo post para indicar que la ruta es usada para recibir informaci\xf3n de un formulario ")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Connfig/Routes.php"',title:'"app/Connfig/Routes.php"'},"$route->post('/auth/login', 'AuthController::login')\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"La estructura para crear rutas es $route->",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"m\xe9todo")),"('",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"url_esperada")),"', '",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"controlador")),"::",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"funci\xf3n_del_controlador")),"'), la url siempre debe comenzar con ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"/")))))}m.isMDXComponent=!0}}]);