"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[556],{3905:function(e,a,o){o.d(a,{Zo:function(){return d},kt:function(){return m}});var t=o(7294);function r(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function l(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,t)}return o}function n(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?l(Object(o),!0).forEach((function(a){r(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function s(e,a){if(null==e)return{};var o,t,r=function(e,a){if(null==e)return{};var o,t,r={},l=Object.keys(e);for(t=0;t<l.length;t++)o=l[t],a.indexOf(o)>=0||(r[o]=e[o]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)o=l[t],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var i=t.createContext({}),p=function(e){var a=t.useContext(i),o=a;return e&&(o="function"==typeof e?e(a):n(n({},a),e)),o},d=function(e){var a=p(e.components);return t.createElement(i.Provider,{value:a},e.children)},u={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},c=t.forwardRef((function(e,a){var o=e.components,r=e.mdxType,l=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(o),m=r,f=c["".concat(i,".").concat(m)]||c[m]||u[m]||l;return o?t.createElement(f,n(n({ref:a},d),{},{components:o})):t.createElement(f,n({ref:a},d))}));function m(e,a){var o=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=o.length,n=new Array(l);n[0]=c;var s={};for(var i in a)hasOwnProperty.call(a,i)&&(s[i]=a[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,n[1]=s;for(var p=2;p<l;p++)n[p]=o[p];return t.createElement.apply(null,n)}return t.createElement.apply(null,o)}c.displayName="MDXCreateElement"},1984:function(e,a,o){o.r(a),o.d(a,{assets:function(){return d},contentTitle:function(){return i},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var t=o(7462),r=o(3366),l=(o(7294),o(3905)),n=["components"],s={sidebar_position:4},i="Editar empleado",p={unversionedId:"CRUD-Empleados/editar-empleado",id:"CRUD-Empleados/editar-empleado",title:"Editar empleado",description:"1. Creamos la ruta que mostrara la vista con el formulario para editar un usuario en app/Config/Routes.php",source:"@site/docs/CRUD-Empleados/editar-empleado.md",sourceDirName:"CRUD-Empleados",slug:"/CRUD-Empleados/editar-empleado",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/CRUD-Empleados/editar-empleado",editUrl:"https://github.com/vegonz/MSC-Prestaexpress-Codeigniter-4/tree/master/docs/docs/CRUD-Empleados/editar-empleado.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Crear empleado",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/CRUD-Empleados/crear-empleado"},next:{title:"Eliminar empleado",permalink:"/MSC-Prestaexpress-Codeigniter-4/docs/CRUD-Empleados/eliminar-empleado"}},d={},u=[{value:"procesar datos del formulario",id:"procesar-datos-del-formulario",level:2}],c={toc:u};function m(e){var a=e.components,o=(0,r.Z)(e,n);return(0,l.kt)("wrapper",(0,t.Z)({},c,o,{components:a,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"editar-empleado"},"Editar empleado"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Creamos la ruta que mostrara la vista con el formulario para editar un usuario en ",(0,l.kt)("inlineCode",{parentName:"li"},"app/Config/Routes.php"))),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Como es necesario conocer cual usuario queremos editar, se manda como par\xe1metro el id del empleado para obtener sus datos y mandarlos al formulario"))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Para mandar un par\xe1metro al controlador a traves de la url podemos usar (:num) para indicar que el par\xe1metro sera num\xe9rico, y en e; controlador numeramos /$1 el par\xe1metro, se pueden enviar varios par\xe1metro y ser\xe1n enviados en el orden en el que aparecen")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Config/Routes.php"',title:'"app/Config/Routes.php"'},"$routes->get('empleados/editar/(:num)', 'EmpleadoController::editar/$1');\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Creamos la funci\xf3n ",(0,l.kt)("inlineCode",{parentName:"li"},"editar")," en el controlador ",(0,l.kt)("inlineCode",{parentName:"li"},"EmpleadoController.php")," (que creamos en la secci\xf3n de ",(0,l.kt)("a",{parentName:"li",href:"/docs/CRUD-Empleados/preparacion"},"preparaci\xf3n"),") ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Controllers/EmpleadoController.php"',title:'"app/Controllers/EmpleadoController.php"'},"// vista de formulario para editar un empleado\npublic function editar($id_empleado)\n{\n    $empleadoModel = new EmpleadoModel(); // instancia del modelo empleado para buscar al empleado por $id_empleado que recibimos como par\xe1metro por la url\n    $puestosModel = new PuestoModel(); // instancia del modelo puestos para enviarlos a la vista del formulario y que el usuario pueda seleccionar uno\n    $detEmpPuestoModel = new DetEmpPuestoModel(); // instancia del modelo DetEmpPuesto para buscar el puesto actual del empleado a editar, y para mostrar el historial de puestos del empleado\n\n    $data['empleado'] = $empleadoModel->find($id_empleado); // informaci\xf3n del empleado a modificar\n    $data['puestos'] = $puestosModel->findAll(); // lista de puestos disponibles\n    $data['puestoActual'] = $detEmpPuestoModel->where('id_empleado', $id_empleado)->orderBy('id_det_emp_puesto', 'desc')->first();\n\n    if (!$data['empleado']) : // si el usuario no existe o no esta activo...\n        session()->setFlashdata('error', 'Ese usuario no existe.');\n        return redirect()->to(base_url('/empleados'));\n    endif;\n\n    $data['puestosEmpleado'] = $detEmpPuestoModel\n        ->select('puesto.pst_nombre, det_emp_puesto.*') // obtener el nombre del puesto y la informaci\xf3n de la tabla detalle \n        ->join('puesto', 'puesto.id_puesto = det_emp_puesto.id_puesto') // inner join de tabla puesto con det_emp_puesto\n        ->where('id_empleado', $id_empleado)\n        ->orderBy('id_det_emp_puesto', 'desc')\n        ->withDeleted() // por que queremos obtener incluso los puestos que no son actuales\n        ->find(); // lista de puestos que ha tenido el empleado, como se necesita hacer \n    return view('empleado/editar', $data);\n}\n")),(0,l.kt)("ol",{start:3},(0,l.kt)("li",{parentName:"ol"},"Creamos la vista del formulario de editar en un nuevo  archivo ",(0,l.kt)("inlineCode",{parentName:"li"},"app/Views/empleado/editar.php"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php",metastring:'"app/Views/empleado/editar.php"','"app/Views/empleado/editar.php"':!0},'<?= $this->extend(\'plantilla\') ?>\n<?= $this->section(\'contenido\') ?>\n<div class="container mt-3">\n    <div class="row justify-content-between align-items-center">\n        <h3 class="col-auto">Editar Empleado</h3>\n        <div class="col-auto">\n            <button form="formularioEmpleado" class="btn btn-primary btn-sm" title="Registrar empleado">\n                Actualizar\n            </button>\n        </div>\n    </div>\n    <form action="<?php echo base_url(\'empleados/actualizar/\' . $empleado->id_empleado); ?>" method="post" class="row g-3" id="formularioEmpleado">\n        <div class="col-md-6">\n            <label for="emp_nombre" class="form-label">Nombre</label>\n            <input required type="text" size="5" class="form-control" value="<?= $empleado->emp_nombre ?>" name="emp_nombre" id="emp_nombre">\n        </div>\n        <div class="col-md-6">\n            <label for="usuario" class="form-label">Usuario</label>\n            <input required type="text" class="form-control" value="<?= $empleado->usuario ?>" name=" usuario" id=" usuario">\n        </div>\n        <div class="col-md-6">\n            <label for="contrasena" class="form-label">Contrase\xf1a</label>\n            <input type="password" class="form-control" name="contrasena" id="contrasena" placeholder="Dejar en blanco para mantener la misma">\n        </div>\n        <div class="col-md-6">\n            <label for="puesto" class="form-label">Puesto</label>\n            <select required class="form-select" aria-label="Selecci\xf3n de puesto de empleado" name="puesto" id="puesto">\n                <option disabled selected value="">Seleccionar</option>\n                <?php foreach ($puestos as $puesto) : ?>\n                    <option value="<?php echo $puesto->id_puesto; ?>" <?php echo ($puestoActual and $puestoActual->id_puesto == $puesto->id_puesto) ? \'selected\' : \'\'; ?>><?php echo $puesto->pst_nombre; ?></option>\n                <?php endforeach; ?>\n\n            </select>\n        </div>\n        <div class="col-md-12">\n            <label class="form-check-label" for="estado">Estado</label>\n            <div class="col-md-6">\n                <label for="estado" class="form-label">Estado</label>\n                <div class="form-check-inline">\n                    <input class="form-check-input" type="radio" value="1" name="estado" id="activo" <?php echo $empleado->estado == 1 ? \'checked\' : \'\'; ?>>\n                    <label class="form-check-label" for="activo">\n                        Activo\n                    </label>\n                </div>\n                <div class="form-check-inline">\n                    <input class="form-check-input" type="radio" value="0" name="estado" id="inactivo" <?php echo $empleado->estado == 0 ? \'checked\' : \'\'; ?>>\n                    <label class="form-check-label" for="inactivo">\n                        Inactivo\n                    </label>\n                </div>\n            </div>\n        </div>\n    </form>\n    <h4>Puestos</h4>\n    <table class="table table-bordered table-striped table-responsive table-hover">\n        <?php foreach ($puestosEmpleado as $puesto) : ?>\n            <tr>\n                <td><?php echo $puesto->pst_nombre; ?></td>\n                <td><?php echo $puesto->fecha_inicio; ?></td>\n                <td><?php echo $puesto->fecha_fin ?? \'-\'; ?></td>\n            </tr>\n        <?php endforeach; ?>\n    </table>\n</div>\n</div>\n<?= $this->endSection() ?>\n')),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"En los campos del formulario usamos el par\xe1metro value para establecer su valor por defecto con la informaci\xf3n recibida desde el controlador, p.e. en campo nombre ",(0,l.kt)("inlineCode",{parentName:"p"},'value="<?= $empleado->emp_nombre ?>"'))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"En los campos select y checkbox usamos condiciones if para comprobar cul opci\xf3n del select debe estar seleccionada ",(0,l.kt)("inlineCode",{parentName:"p"},"<?php echo ($puestoActual and $puestoActual->id_puesto == $puesto->id_puesto) ? 'selected' : ''; ?>")," y si el checkbox debe estar activado ",(0,l.kt)("inlineCode",{parentName:"p"},"<?php echo $empleado->estado == 1 ? 'checked' : ''; ?>"))),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"En el par\xe1metro action del formulario estamos usando la url que crearemos en el siguiente paso para procesar la informaci\xf3n ",(0,l.kt)("inlineCode",{parentName:"p"},"<?php echo base_url('empleados/actualizar/' . $empleado->id_empleado); ?>")," junto con el par\xe1metro del id de empleado")),(0,l.kt)("ol",{start:4},(0,l.kt)("li",{parentName:"ol"},"Comprobamos que funcione en usando el id de un empleado que exista en la bd, p.e. '1' ",(0,l.kt)("a",{parentName:"li",href:"http://localhost/prestaexpress/public/empleados/editar/1"},"http://localhost/prestaexpress/public/empleados/editar/1"))),(0,l.kt)("h2",{id:"procesar-datos-del-formulario"},"procesar datos del formulario"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Creamos la url donde vamos a mandar la informaci\xf3n del formulario para registrarla en la base de datos en ",(0,l.kt)("inlineCode",{parentName:"li"},"app/Config/Routes.php"),", al igual que en la ruta de ",(0,l.kt)("em",{parentName:"li"},"editar")," aqui mandamos el par\xe1metro del empleado que se desea actualizar")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Config/Routes.php"',title:'"app/Config/Routes.php"'},"$routes->post('empleados/actualizar/(:num)', 'EmpleadoController::actualizar/$1');\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Creamos la funci\xf3n ",(0,l.kt)("inlineCode",{parentName:"li"},"registrar")," del controlador ",(0,l.kt)("inlineCode",{parentName:"li"},"EmpleadoController.php"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php",metastring:'title="app/Controllers/EmpleadoController.php"',title:'"app/Controllers/EmpleadoController.php"'},"// actualizar los datos de un registro\npublic function actualizar($id_empleado)\n{\n    $empleadoModel = new EmpleadoModel(); // modelo para actualizar empleado\n    $detEmpPuestoModel = new DetEmpPuestoModel(); // modelo para actualizar el detalle empleado puesto\n\n    $data = [\n        'emp_nombre' => $this->request->getPost('emp_nombre'),\n        'usuario' => $this->request->getPost('usuario'),\n        'estado'  => $this->request->getPost('estado')\n    ]; // informaci\xf3n recibida del formulario\n\n    // Solo actualizar la contrase\xf1a si el usuario ingreso una nueva en  el formulario\n    if ($this->request->getPost('contrasena')) :\n        $data = [\n            'contrasena' => password_hash($this->request->getPost('contrasena'), PASSWORD_BCRYPT)\n        ]; // agregamos la nueva contrase\xf1a al array de campos que se van a actualizar\n    endif;\n\n    $empleadoModel->update($id_empleado, $data); // actualizamos el empleado con la info del formulario\n\n    // si el puesto del empleado cambio, actualizamos la tabla de detalle\n    $puestoActual = $detEmpPuestoModel->where('id_empleado', $id_empleado)->first(); // buscamos el puesto actual registrado del empleado\n    if (!$puestoActual) $detEmpPuestoModel->insert([\n            'id_empleado' => $id_empleado,\n            'id_puesto' => $this->request->getPost('puesto')\n    ]);\n    if ($puestoActual and $puestoActual->id_puesto != $this->request->getPost('puesto')) : // revisamos si el puesto recibido del formulario es diferente para actualizarlo\n        // removemos el puesto actual\n        $detEmpPuestoModel->delete($puestoActual->id_det_emp_puesto);\n        // ingresamos el nuevo puesto\n        $detEmpPuestoModel->insert([\n            'id_empleado' => $id_empleado,\n            'id_puesto' => $this->request->getPost('puesto')\n        ]);\n    endif;\n\n    session()->setFlashdata('success', 'El usuario fue actualizado.');\n    return redirect()->back();\n}\n")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"La contrase\xf1a del usuario solo se actualiza si el usuario la cambia en el formulario")),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"Solo se actualiza la tabla detalle si se actualiza en el formulario, se eliminar el puesto actual y se inserta el nuevo")))}m.isMDXComponent=!0}}]);